id: io.github.supertoq.clock
runtime: org.gnome.Platform
runtime-version: "49"
sdk: org.gnome.Sdk
command: supertoq-clock

finish-args:
  - --socket=fallback-x11                                 # X11-Fallback
  - --socket=wayland                                      # Wayland...
  - --device=dri                                          # GPU...

modules:
  - name: clock
    buildsystem: simple
    build-commands:
      # ----- Erstelle Verzeichnis‑Struktur -----
      - mkdir -p _build/bin _build/share/locale/en_US/LC_MESSAGES _build/share/locale/en_GB/LC_MESSAGES _build/share/applications _build/share/icons/hicolor/scalable/apps _build/share/icons/hicolor/128x128/apps _build/share/icons/hicolor/256x256/apps _build//share/pixmaps

      # ----- Resourcesn kompilieren -----
      - glib-compile-resources src/resources.xml --sourcedir=data/icons/ --generate-source --target=src/io.github.supertoq.clock.gresource.c

      # ----- Kompilieren der Anwendung -----
      - gcc $(pkg-config --cflags gtk4 libadwaita-1) -o _build/bin/supertoq-clock src/clock.c src/ src/io.github.supertoq.clock.gresource.c $(pkg-config --libs gtk4 libadwaita-1) -lm -Wall -Wextra

      # ----- Warunungen unterdrücken -----
      

      # ----- Erstellen der .po‑Datei -----
      - msgfmt src/po/en_US.po --output-file=_build/share/locale/en_US/LC_MESSAGES/supertoq-clock.mo
      - msgfmt src/po/en_GB.po --output-file=_build/share/locale/en_GB/LC_MESSAGES/supertoq-clock.mo

      # ----- Installations
      - install -D -m 0755 _build/bin/supertoq-clock /app/bin/supertoq-clock
      - install -D -m 0644 packaging/io.github.supertoq.clock.desktop /app/share/applications/io.github.supertoq.clock.desktop
      - install -D -m 0644 packaging/io.github.supertoq.clock.metainfo.xml /app/share/metainfo/io.github.supertoq.clock.metainfo.xml
      - install -D -m 0644 packaging/io.github.supertoq.clock.svg /app/share/icons/hicolor/scalable/apps/io.github.supertoq.clock.svg
      - install -D -m 0644 packaging/128px.png /app/share/icons/hicolor/128x128/apps/io.github.supertoq.clock.png
      - install -D -m 0644 packaging/256px.png /app/share/icons/hicolor/256x256/apps/io.github.supertoq.clock.png
      - install -D -m 0644 packaging/oledsaver_preview_img_light1.png /app/share/pixmaps/clock_preview_img_light1.png
      - install -D -m 0644 packaging/io.github.supertoq.clock.svg /app/share/pixmaps/io.github.supertoq.clock.svg
      - install -D -m 0644 _build/share/locale/en_US/LC_MESSAGES/supertoq-clock.mo /app/share/locale/en_US/LC_MESSAGES/supertoq-clock.mo
      - install -D -m 0644 _build/share/locale/en_GB/LC_MESSAGES/supertoq-clock.mo /app/share/locale/en_GB/LC_MESSAGES/supertoq-clock.mo

    sources:
      - type: dir
        path: .
